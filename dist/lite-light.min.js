const h = {};
let w = 0, A = 0, E = 0, T = 0, b = 0, r = !1;
function u(e) {
  return h[e] || (h[e] = new Image(), h[e].src = e), h[e];
}
function S() {
  const e = window.scrollY;
  document.body.style.position = "fixed", document.body.style.top = `-${e}px`, document.body.style.width = "100%", document.body.style.overflowY = "scroll";
}
function I() {
  const e = document.body.style.top;
  document.body.style.position = "", document.body.style.top = "", document.body.style.width = "", document.body.style.overflowY = "", window.scrollTo(0, parseInt(e || "0") * -1);
}
function M(e = {}) {
  const n = {
    imageSelector: e.imageSelector || "img[data-lightbox]",
    imageUrlAttribute: e.imageUrlAttribute || "data-lightbox",
    lightboxClass: e.lightboxClass || "lite-light",
    swipeThreshold: e.swipeThreshold || 50,
    fadeAnimationDuration: e.fadeAnimationDuration || 150,
    ...e
  };
  document.querySelector(`.${n.lightboxClass}`) || Y(n.lightboxClass), document.addEventListener("click", (g) => {
    if (g.target.tagName !== "IMG" || !g.target.hasAttribute(n.imageUrlAttribute)) return;
    const a = Array.from(document.querySelectorAll(n.imageSelector));
    let l = a.findIndex((t) => t === g.target);
    const i = document.querySelector(`.${n.lightboxClass}`), s = i.querySelector("img");
    function v(t) {
      const o = (t - 1 + a.length) % a.length, c = (t + 1) % a.length;
      u(a[o].getAttribute(n.imageUrlAttribute)), u(a[c].getAttribute(n.imageUrlAttribute));
    }
    function d(t) {
      l = (t + a.length) % a.length;
      const o = a[l].getAttribute(n.imageUrlAttribute);
      u(o), s.classList.add("lite-light-fade-out"), s.addEventListener("animationend", function c() {
        s.src = o, s.classList.remove("lite-light-fade-out"), s.classList.add("lite-light-fade-in"), v(l), s.addEventListener("animationend", function() {
          s.classList.remove("lite-light-fade-in");
        }, { once: !0 }), s.removeEventListener("animationend", c);
      }, { once: !0 });
    }
    function y(t) {
      if (t.length < 2) return 0;
      const o = t[0], c = t[1];
      return Math.sqrt(
        Math.pow(c.screenX - o.screenX, 2) + Math.pow(c.screenY - o.screenY, 2)
      );
    }
    function p(t) {
      t.touches.length === 1 ? (w = t.touches[0].screenX, E = t.touches[0].screenY, r = !1) : t.touches.length === 2 && (b = y(t.touches), r = !0);
    }
    function L(t) {
      if (t.touches.length === 2) {
        r = !0;
        const o = y(t.touches);
        Math.abs(o - b) > 50 && (r = !0);
      }
    }
    function x(t) {
      if (t.changedTouches.length === 1 && !r && t.touches.length === 0) {
        A = t.changedTouches[0].screenX, T = t.changedTouches[0].screenY;
        const o = A - w, c = T - E;
        Math.abs(o) > Math.abs(c) && Math.abs(o) > n.swipeThreshold && (d(o > 0 ? l - 1 : l + 1), t.stopPropagation());
      }
      t.touches.length === 0 && (r = !1, b = 0);
    }
    function m(t) {
      t.key === "ArrowLeft" ? (d(l - 1), t.preventDefault()) : t.key === "ArrowRight" ? (d(l + 1), t.preventDefault()) : t.key === "Escape" && (f(), t.preventDefault());
    }
    i.style.display = "flex", u(a[l].getAttribute(n.imageUrlAttribute)), v(l), s.src = a[l].getAttribute(n.imageUrlAttribute), s.classList.add("lite-light-fade-in"), S(), s.addEventListener("animationend", () => {
      s.classList.remove("lite-light-fade-in");
    }, { once: !0 }), i.removeEventListener("touchstart", p), i.removeEventListener("touchmove", L), i.removeEventListener("touchend", x), i.addEventListener("touchstart", p), i.addEventListener("touchmove", L), i.addEventListener("touchend", x), document.removeEventListener("keydown", m), document.addEventListener("keydown", m), i.querySelector(".lite-light-prev").onclick = (t) => {
      t.stopPropagation(), d(l - 1);
    }, i.querySelector(".lite-light-next").onclick = (t) => {
      t.stopPropagation(), d(l + 1);
    };
    function f() {
      i.style.display = "none", I(), document.removeEventListener("keydown", m);
    }
    i.querySelector(".lite-light-close").onclick = (t) => {
      t.stopPropagation(), f();
    }, i.onclick = () => {
      f();
    };
  });
}
function Y(e) {
  const n = `
    <div class="${e}">
      <div class="lite-light-prev lite-light-button">
        <span class="lite-light-arrow lite-light-left"></span>
      </div>
      <img style="max-width: 90%; max-height: 90%;" />
      <div class="lite-light-next lite-light-button">
        <span class="lite-light-arrow lite-light-right"></span>
      </div>
      <div class="lite-light-close lite-light-button">
        <span class="lite-light-bar"></span>
        <span class="lite-light-bar"></span>
      </div>
    </div>
  `;
  document.body.insertAdjacentHTML("beforeend", n);
}
function k(e) {
  M(e);
}
export {
  k as init,
  M as initLiteLight
};
